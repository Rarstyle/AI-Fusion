{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/egors/AI-Fusion/frontend/src/lib/poseDetection.ts"],"sourcesContent":["import {\r\n  PoseLandmarker,\r\n  FilesetResolver,\r\n  PoseLandmarkerResult,\r\n} from \"@mediapipe/tasks-vision\";\r\n\r\nexport interface PoseLandmark {\r\n  x: number;\r\n  y: number;\r\n  z: number;\r\n  visibility?: number;\r\n}\r\n\r\nexport class PoseDetectionService {\r\n  private poseLandmarker: PoseLandmarker | null = null;\r\n  private initialized = false;\r\n\r\n  async initialize() {\r\n    if (this.initialized) return;\r\n\r\n    try {\r\n      const vision = await FilesetResolver.forVisionTasks(\r\n        \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm\",\r\n      );\r\n\r\n      this.poseLandmarker = await PoseLandmarker.createFromOptions(vision, {\r\n        baseOptions: {\r\n          modelAssetPath:\r\n            \"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task\",\r\n          delegate: \"GPU\",\r\n        },\r\n        runningMode: \"VIDEO\",\r\n        numPoses: 1,\r\n        minPoseDetectionConfidence: 0.5,\r\n        minPosePresenceConfidence: 0.5,\r\n        minTrackingConfidence: 0.5,\r\n      });\r\n\r\n      this.initialized = true;\r\n    } catch (error) {\r\n      console.error(\"Failed to initialize pose detection:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async detectPose(\r\n    video: HTMLVideoElement,\r\n    timestamp: number,\r\n  ): Promise<PoseLandmarkerResult | null> {\r\n    if (!this.poseLandmarker || !this.initialized) {\r\n      throw new Error(\"Pose detection not initialized\");\r\n    }\r\n\r\n    try {\r\n      return this.poseLandmarker.detectForVideo(video, timestamp);\r\n    } catch (error) {\r\n      console.error(\"Error detecting pose:\", error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this.poseLandmarker) {\r\n      this.poseLandmarker.close();\r\n      this.poseLandmarker = null;\r\n      this.initialized = false;\r\n    }\r\n  }\r\n}\r\n\r\n// Utility functions for calculating angles and distances\r\nexport function calculateAngle(\r\n  a: PoseLandmark,\r\n  b: PoseLandmark,\r\n  c: PoseLandmark,\r\n): number {\r\n  const radians =\r\n    Math.atan2(c.y - b.y, c.x - b.x) - Math.atan2(a.y - b.y, a.x - b.x);\r\n  let angle = Math.abs((radians * 180.0) / Math.PI);\r\n\r\n  if (angle > 180.0) {\r\n    angle = 360 - angle;\r\n  }\r\n\r\n  return angle;\r\n}\r\n\r\nexport function calculateDistance(a: PoseLandmark, b: PoseLandmark): number {\r\n  return Math.sqrt(\r\n    Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2) + Math.pow(b.z - a.z, 2),\r\n  );\r\n}\r\n\r\nexport function isLandmarkVisible(\r\n  landmark: PoseLandmark,\r\n  threshold = 0.5,\r\n): boolean {\r\n  return landmark.visibility !== undefined && landmark.visibility > threshold;\r\n}\r\n\r\n// MediaPipe Pose Landmark indices\r\nexport const PoseLandmarkIndices = {\r\n  NOSE: 0,\r\n  LEFT_EYE_INNER: 1,\r\n  LEFT_EYE: 2,\r\n  LEFT_EYE_OUTER: 3,\r\n  RIGHT_EYE_INNER: 4,\r\n  RIGHT_EYE: 5,\r\n  RIGHT_EYE_OUTER: 6,\r\n  LEFT_EAR: 7,\r\n  RIGHT_EAR: 8,\r\n  MOUTH_LEFT: 9,\r\n  MOUTH_RIGHT: 10,\r\n  LEFT_SHOULDER: 11,\r\n  RIGHT_SHOULDER: 12,\r\n  LEFT_ELBOW: 13,\r\n  RIGHT_ELBOW: 14,\r\n  LEFT_WRIST: 15,\r\n  RIGHT_WRIST: 16,\r\n  LEFT_PINKY: 17,\r\n  RIGHT_PINKY: 18,\r\n  LEFT_INDEX: 19,\r\n  RIGHT_INDEX: 20,\r\n  LEFT_THUMB: 21,\r\n  RIGHT_THUMB: 22,\r\n  LEFT_HIP: 23,\r\n  RIGHT_HIP: 24,\r\n  LEFT_KNEE: 25,\r\n  RIGHT_KNEE: 26,\r\n  LEFT_ANKLE: 27,\r\n  RIGHT_ANKLE: 28,\r\n  LEFT_HEEL: 29,\r\n  RIGHT_HEEL: 30,\r\n  LEFT_FOOT_INDEX: 31,\r\n  RIGHT_FOOT_INDEX: 32,\r\n};\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAaO,MAAM;IACH,iBAAwC,KAAK;IAC7C,cAAc,MAAM;IAE5B,MAAM,aAAa;QACjB,IAAI,IAAI,CAAC,WAAW,EAAE;QAEtB,IAAI;YACF,MAAM,SAAS,MAAM,+LAAe,CAAC,cAAc,CACjD;YAGF,IAAI,CAAC,cAAc,GAAG,MAAM,8LAAc,CAAC,iBAAiB,CAAC,QAAQ;gBACnE,aAAa;oBACX,gBACE;oBACF,UAAU;gBACZ;gBACA,aAAa;gBACb,UAAU;gBACV,4BAA4B;gBAC5B,2BAA2B;gBAC3B,uBAAuB;YACzB;YAEA,IAAI,CAAC,WAAW,GAAG;QACrB,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,wCAAwC;YACtD,MAAM;QACR;IACF;IAEA,MAAM,WACJ,KAAuB,EACvB,SAAiB,EACqB;QACtC,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YAC7C,MAAM,IAAI,MAAM;QAClB;QAEA,IAAI;YACF,OAAO,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,OAAO;QACnD,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO;QACT;IACF;IAEA,QAAQ;QACN,IAAI,IAAI,CAAC,cAAc,EAAE;YACvB,IAAI,CAAC,cAAc,CAAC,KAAK;YACzB,IAAI,CAAC,cAAc,GAAG;YACtB,IAAI,CAAC,WAAW,GAAG;QACrB;IACF;AACF;AAGO,SAAS,eACd,CAAe,EACf,CAAe,EACf,CAAe;IAEf,MAAM,UACJ,KAAK,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,CAAC,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,GAAG,EAAE,CAAC;IACpE,IAAI,QAAQ,KAAK,GAAG,CAAC,AAAC,UAAU,QAAS,KAAK,EAAE;IAEhD,IAAI,QAAQ,OAAO;QACjB,QAAQ,MAAM;IAChB;IAEA,OAAO;AACT;AAEO,SAAS,kBAAkB,CAAe,EAAE,CAAe;IAChE,OAAO,KAAK,IAAI,CACd,KAAK,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,KAAK,KAAK,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,KAAK,KAAK,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE;AAE1E;AAEO,SAAS,kBACd,QAAsB,EACtB,YAAY,GAAG;IAEf,OAAO,SAAS,UAAU,KAAK,aAAa,SAAS,UAAU,GAAG;AACpE;AAGO,MAAM,sBAAsB;IACjC,MAAM;IACN,gBAAgB;IAChB,UAAU;IACV,gBAAgB;IAChB,iBAAiB;IACjB,WAAW;IACX,iBAAiB;IACjB,UAAU;IACV,WAAW;IACX,YAAY;IACZ,aAAa;IACb,eAAe;IACf,gBAAgB;IAChB,YAAY;IACZ,aAAa;IACb,YAAY;IACZ,aAAa;IACb,YAAY;IACZ,aAAa;IACb,YAAY;IACZ,aAAa;IACb,YAAY;IACZ,aAAa;IACb,UAAU;IACV,WAAW;IACX,WAAW;IACX,YAAY;IACZ,YAAY;IACZ,aAAa;IACb,WAAW;IACX,YAAY;IACZ,iBAAiB;IACjB,kBAAkB;AACpB","debugId":null}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/egors/AI-Fusion/frontend/src/lib/formAnalysis.ts"],"sourcesContent":["import { ExerciseType, FormFeedback } from \"@/types/exercise\";\r\nimport {\r\n  PoseLandmark,\r\n  calculateAngle,\r\n  PoseLandmarkIndices as PLI,\r\n  isLandmarkVisible,\r\n} from \"./poseDetection\";\r\n\r\ninterface ExerciseState {\r\n  phase: \"up\" | \"down\" | \"neutral\";\r\n  repCount: number;\r\n  lastPhaseChange: number;\r\n  minAngleThisRep?: number;\r\n  maxAngleThisRep?: number;\r\n}\r\n\r\nexport class FormAnalyzer {\r\n  private state: ExerciseState = {\r\n    phase: \"neutral\",\r\n    repCount: 0,\r\n    lastPhaseChange: Date.now(),\r\n  };\r\n\r\n  private exerciseType: ExerciseType;\r\n\r\n  constructor(exerciseType: ExerciseType) {\r\n    this.exerciseType = exerciseType;\r\n  }\r\n\r\n  reset() {\r\n    this.state = {\r\n      phase: \"neutral\",\r\n      repCount: 0,\r\n      lastPhaseChange: Date.now(),\r\n    };\r\n  }\r\n\r\n  analyze(\r\n    landmarks: PoseLandmark[],\r\n    timestamp: number,\r\n  ): {\r\n    feedback: FormFeedback[];\r\n    repCounted: boolean;\r\n    phase: string;\r\n  } {\r\n    switch (this.exerciseType) {\r\n      case \"squat\":\r\n        return this.analyzeSquat(landmarks, timestamp);\r\n      case \"deadlift\":\r\n        return this.analyzeDeadlift(landmarks, timestamp);\r\n      case \"pushup\":\r\n        return this.analyzePushup(landmarks, timestamp);\r\n      case \"row\":\r\n        return this.analyzeRow(landmarks, timestamp);\r\n      case \"overhead-press\":\r\n        return this.analyzeOverheadPress(landmarks, timestamp);\r\n      default:\r\n        return { feedback: [], repCounted: false, phase: \"neutral\" };\r\n    }\r\n  }\r\n\r\n  private analyzeSquat(landmarks: PoseLandmark[], timestamp: number) {\r\n    const feedback: FormFeedback[] = [];\r\n    let repCounted = false;\r\n\r\n    // Get key landmarks\r\n    const leftHip = landmarks[PLI.LEFT_HIP];\r\n    const leftKnee = landmarks[PLI.LEFT_KNEE];\r\n    const leftAnkle = landmarks[PLI.LEFT_ANKLE];\r\n    const rightKnee = landmarks[PLI.RIGHT_KNEE];\r\n    const leftShoulder = landmarks[PLI.LEFT_SHOULDER];\r\n\r\n    if (\r\n      !isLandmarkVisible(leftHip) ||\r\n      !isLandmarkVisible(leftKnee) ||\r\n      !isLandmarkVisible(leftAnkle)\r\n    ) {\r\n      return { feedback, repCounted, phase: this.state.phase };\r\n    }\r\n\r\n    // Calculate knee angle\r\n    const kneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);\r\n\r\n    // Track min angle during descent\r\n    if (!this.state.minAngleThisRep || kneeAngle < this.state.minAngleThisRep) {\r\n      this.state.minAngleThisRep = kneeAngle;\r\n    }\r\n\r\n    // Check for depth\r\n    const hipBelowKnee = leftHip.y > leftKnee.y;\r\n\r\n    // Phase detection\r\n    if (kneeAngle < 100 && this.state.phase !== \"down\") {\r\n      this.state.phase = \"down\";\r\n      this.state.lastPhaseChange = timestamp;\r\n    } else if (kneeAngle > 160 && this.state.phase === \"down\") {\r\n      // Rep completed\r\n      if (this.state.minAngleThisRep && this.state.minAngleThisRep < 100) {\r\n        this.state.repCount++;\r\n        repCounted = true;\r\n        feedback.push({\r\n          timestamp,\r\n          message: \"‚úì Good rep\",\r\n          severity: \"info\",\r\n          type: \"rep_counted\",\r\n        });\r\n      } else {\r\n        feedback.push({\r\n          timestamp,\r\n          message: \"Insufficient depth\",\r\n          severity: \"warning\",\r\n          type: \"depth\",\r\n        });\r\n      }\r\n      this.state.phase = \"up\";\r\n      this.state.minAngleThisRep = undefined;\r\n    }\r\n\r\n    // Form checks\r\n    // Check knee valgus (knees caving)\r\n    const kneeDistance = Math.abs(leftKnee.x - rightKnee.x);\r\n    const hipDistance = Math.abs(leftHip.x - landmarks[PLI.RIGHT_HIP].x);\r\n\r\n    if (kneeDistance < hipDistance * 0.8 && this.state.phase === \"down\") {\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚ö†Ô∏è Knees caving inward\",\r\n        severity: \"warning\",\r\n        type: \"knee_valgus\",\r\n      });\r\n    }\r\n\r\n    // Check forward lean (simplified)\r\n    const shoulderToHipAngle = Math.abs(leftShoulder.x - leftHip.x);\r\n    if (shoulderToHipAngle > 0.15 && this.state.phase === \"down\") {\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚ö†Ô∏è Excessive forward lean\",\r\n        severity: \"warning\",\r\n        type: \"forward_lean\",\r\n      });\r\n    }\r\n\r\n    return { feedback, repCounted, phase: this.state.phase };\r\n  }\r\n\r\n  private analyzeDeadlift(landmarks: PoseLandmark[], timestamp: number) {\r\n    const feedback: FormFeedback[] = [];\r\n    let repCounted = false;\r\n\r\n    const leftHip = landmarks[PLI.LEFT_HIP];\r\n    const leftShoulder = landmarks[PLI.LEFT_SHOULDER];\r\n    const leftKnee = landmarks[PLI.LEFT_KNEE];\r\n\r\n    if (!isLandmarkVisible(leftHip) || !isLandmarkVisible(leftShoulder)) {\r\n      return { feedback, repCounted, phase: this.state.phase };\r\n    }\r\n\r\n    // Hip angle for phase detection\r\n    const hipHeight = leftHip.y;\r\n\r\n    if (hipHeight < 0.6 && this.state.phase !== \"down\") {\r\n      this.state.phase = \"down\";\r\n      this.state.lastPhaseChange = timestamp;\r\n    } else if (hipHeight > 0.8 && this.state.phase === \"down\") {\r\n      this.state.repCount++;\r\n      repCounted = true;\r\n      this.state.phase = \"up\";\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚úì Rep completed\",\r\n        severity: \"info\",\r\n        type: \"rep_counted\",\r\n      });\r\n    }\r\n\r\n    // Check back rounding (simplified - shoulder ahead of hip)\r\n    const backAngle = Math.abs(leftShoulder.x - leftHip.x);\r\n    if (backAngle > 0.2 && this.state.phase === \"down\") {\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚ö†Ô∏è Keep back neutral\",\r\n        severity: \"warning\",\r\n        type: \"back_rounding\",\r\n      });\r\n    }\r\n\r\n    return { feedback, repCounted, phase: this.state.phase };\r\n  }\r\n\r\n  private analyzePushup(landmarks: PoseLandmark[], timestamp: number) {\r\n    const feedback: FormFeedback[] = [];\r\n    let repCounted = false;\r\n\r\n    const leftShoulder = landmarks[PLI.LEFT_SHOULDER];\r\n    const leftElbow = landmarks[PLI.LEFT_ELBOW];\r\n    const leftWrist = landmarks[PLI.LEFT_WRIST];\r\n    const leftHip = landmarks[PLI.LEFT_HIP];\r\n\r\n    if (\r\n      !isLandmarkVisible(leftShoulder) ||\r\n      !isLandmarkVisible(leftElbow) ||\r\n      !isLandmarkVisible(leftWrist)\r\n    ) {\r\n      return { feedback, repCounted, phase: this.state.phase };\r\n    }\r\n\r\n    // Calculate elbow angle\r\n    const elbowAngle = calculateAngle(leftShoulder, leftElbow, leftWrist);\r\n\r\n    // Track angles\r\n    if (\r\n      !this.state.minAngleThisRep ||\r\n      elbowAngle < this.state.minAngleThisRep\r\n    ) {\r\n      this.state.minAngleThisRep = elbowAngle;\r\n    }\r\n\r\n    // Phase detection\r\n    if (elbowAngle < 90 && this.state.phase !== \"down\") {\r\n      this.state.phase = \"down\";\r\n      this.state.lastPhaseChange = timestamp;\r\n    } else if (elbowAngle > 160 && this.state.phase === \"down\") {\r\n      if (this.state.minAngleThisRep && this.state.minAngleThisRep < 90) {\r\n        this.state.repCount++;\r\n        repCounted = true;\r\n        feedback.push({\r\n          timestamp,\r\n          message: \"‚úì Good rep\",\r\n          severity: \"info\",\r\n          type: \"rep_counted\",\r\n        });\r\n      } else {\r\n        feedback.push({\r\n          timestamp,\r\n          message: \"Go deeper\",\r\n          severity: \"warning\",\r\n          type: \"depth\",\r\n        });\r\n      }\r\n      this.state.phase = \"up\";\r\n      this.state.minAngleThisRep = undefined;\r\n    }\r\n\r\n    // Check for sagging hips\r\n    const shoulderHipDistance = Math.abs(leftShoulder.y - leftHip.y);\r\n    if (shoulderHipDistance < 0.15) {\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚ö†Ô∏è Hips sagging\",\r\n        severity: \"warning\",\r\n        type: \"hip_sag\",\r\n      });\r\n    }\r\n\r\n    return { feedback, repCounted, phase: this.state.phase };\r\n  }\r\n\r\n  private analyzeRow(landmarks: PoseLandmark[], timestamp: number) {\r\n    const feedback: FormFeedback[] = [];\r\n    let repCounted = false;\r\n\r\n    const leftShoulder = landmarks[PLI.LEFT_SHOULDER];\r\n    const leftElbow = landmarks[PLI.LEFT_ELBOW];\r\n    const leftWrist = landmarks[PLI.LEFT_WRIST];\r\n\r\n    if (\r\n      !isLandmarkVisible(leftShoulder) ||\r\n      !isLandmarkVisible(leftElbow) ||\r\n      !isLandmarkVisible(leftWrist)\r\n    ) {\r\n      return { feedback, repCounted, phase: this.state.phase };\r\n    }\r\n\r\n    // Simple elbow position tracking\r\n    const elbowBehindShoulder = leftElbow.x < leftShoulder.x - 0.1;\r\n\r\n    if (elbowBehindShoulder && this.state.phase !== \"down\") {\r\n      this.state.phase = \"down\";\r\n      this.state.lastPhaseChange = timestamp;\r\n    } else if (!elbowBehindShoulder && this.state.phase === \"down\") {\r\n      this.state.repCount++;\r\n      repCounted = true;\r\n      this.state.phase = \"up\";\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚úì Rep completed\",\r\n        severity: \"info\",\r\n        type: \"rep_counted\",\r\n      });\r\n    }\r\n\r\n    return { feedback, repCounted, phase: this.state.phase };\r\n  }\r\n\r\n  private analyzeOverheadPress(landmarks: PoseLandmark[], timestamp: number) {\r\n    const feedback: FormFeedback[] = [];\r\n    let repCounted = false;\r\n\r\n    const leftShoulder = landmarks[PLI.LEFT_SHOULDER];\r\n    const leftElbow = landmarks[PLI.LEFT_ELBOW];\r\n    const leftWrist = landmarks[PLI.LEFT_WRIST];\r\n\r\n    if (\r\n      !isLandmarkVisible(leftShoulder) ||\r\n      !isLandmarkVisible(leftElbow) ||\r\n      !isLandmarkVisible(leftWrist)\r\n    ) {\r\n      return { feedback, repCounted, phase: this.state.phase };\r\n    }\r\n\r\n    const elbowAngle = calculateAngle(leftShoulder, leftElbow, leftWrist);\r\n\r\n    // Arms overhead (locked out)\r\n    if (\r\n      leftWrist.y < leftShoulder.y - 0.2 &&\r\n      elbowAngle > 160 &&\r\n      this.state.phase !== \"up\"\r\n    ) {\r\n      this.state.phase = \"up\";\r\n      this.state.lastPhaseChange = timestamp;\r\n    } else if (leftWrist.y > leftShoulder.y && this.state.phase === \"up\") {\r\n      this.state.repCount++;\r\n      repCounted = true;\r\n      this.state.phase = \"down\";\r\n      feedback.push({\r\n        timestamp,\r\n        message: \"‚úì Rep completed\",\r\n        severity: \"info\",\r\n        type: \"rep_counted\",\r\n      });\r\n    }\r\n\r\n    return { feedback, repCounted, phase: this.state.phase };\r\n  }\r\n\r\n  getRepCount(): number {\r\n    return this.state.repCount;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 419, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/egors/AI-Fusion/frontend/src/components/WorkoutCamera.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { ExerciseType, FormFeedback, RepData } from \"@/types/exercise\";\r\nimport { PoseDetectionService } from \"@/lib/poseDetection\";\r\nimport { FormAnalyzer } from \"@/lib/formAnalysis\";\r\n\r\ninterface WorkoutCameraProps {\r\n  exerciseId: ExerciseType;\r\n  onComplete: (reps: RepData[], allFeedback: FormFeedback[]) => void;\r\n}\r\n\r\nexport default function WorkoutCamera({\r\n  exerciseId,\r\n  onComplete,\r\n}: WorkoutCameraProps) {\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [repCount, setRepCount] = useState(0);\r\n  const [currentFeedback, setCurrentFeedback] = useState<FormFeedback[]>([]);\r\n  const [phase, setPhase] = useState<string>(\"neutral\");\r\n  const [isActive, setIsActive] = useState(false);\r\n\r\n  const poseServiceRef = useRef<PoseDetectionService | null>(null);\r\n  const formAnalyzerRef = useRef<FormAnalyzer | null>(null);\r\n  const animationFrameRef = useRef<number | null>(null);\r\n  const allFeedbackRef = useRef<FormFeedback[]>([]);\r\n  const repsDataRef = useRef<RepData[]>([]);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n\r\n  // Initialize camera and pose detection\r\n  useEffect(() => {\r\n    let mounted = true;\r\n\r\n    async function setup() {\r\n      try {\r\n        // Request camera access\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n          video: {\r\n            width: { ideal: 1280 },\r\n            height: { ideal: 720 },\r\n            facingMode: \"user\",\r\n          },\r\n          audio: false,\r\n        });\r\n\r\n        if (!mounted) {\r\n          stream.getTracks().forEach((track) => track.stop());\r\n          return;\r\n        }\r\n\r\n        streamRef.current = stream;\r\n\r\n        if (videoRef.current) {\r\n          videoRef.current.srcObject = stream;\r\n          await new Promise((resolve) => {\r\n            if (videoRef.current) {\r\n              videoRef.current.onloadedmetadata = resolve;\r\n            }\r\n          });\r\n          await videoRef.current.play();\r\n        }\r\n\r\n        // Initialize pose detection\r\n        const poseService = new PoseDetectionService();\r\n        await poseService.initialize();\r\n        poseServiceRef.current = poseService;\r\n\r\n        // Initialize form analyzer\r\n        formAnalyzerRef.current = new FormAnalyzer(exerciseId);\r\n\r\n        if (mounted) {\r\n          setIsLoading(false);\r\n          setIsActive(true);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Setup error:\", err);\r\n        if (mounted) {\r\n          setError(\r\n            \"Failed to access camera or initialize pose detection. Please check permissions.\",\r\n          );\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    setup();\r\n\r\n    return () => {\r\n      mounted = false;\r\n      if (streamRef.current) {\r\n        streamRef.current.getTracks().forEach((track) => track.stop());\r\n      }\r\n      if (poseServiceRef.current) {\r\n        poseServiceRef.current.close();\r\n      }\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, [exerciseId]);\r\n\r\n  // Detection loop\r\n  useEffect(() => {\r\n    if (\r\n      !isActive ||\r\n      !videoRef.current ||\r\n      !poseServiceRef.current ||\r\n      !formAnalyzerRef.current\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    let lastTimestamp = 0;\r\n\r\n    async function detectLoop() {\r\n      if (\r\n        !videoRef.current ||\r\n        !poseServiceRef.current ||\r\n        !formAnalyzerRef.current ||\r\n        !isActive\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const video = videoRef.current;\r\n      const now = performance.now();\r\n\r\n      try {\r\n        // Detect pose\r\n        const result = await poseServiceRef.current.detectPose(video, now);\r\n\r\n        if (result && result.landmarks && result.landmarks.length > 0) {\r\n          const landmarks = result.landmarks[0];\r\n\r\n          // Analyze form\r\n          const analysis = formAnalyzerRef.current.analyze(\r\n            landmarks,\r\n            Date.now(),\r\n          );\r\n\r\n          // Update feedback\r\n          if (analysis.feedback.length > 0) {\r\n            setCurrentFeedback((prev) => {\r\n              const newFeedback = [...analysis.feedback];\r\n              allFeedbackRef.current.push(...newFeedback);\r\n              return newFeedback;\r\n            });\r\n\r\n            // Clear feedback after a delay\r\n            setTimeout(() => {\r\n              setCurrentFeedback([]);\r\n            }, 2000);\r\n          }\r\n\r\n          // Update rep count\r\n          if (analysis.repCounted) {\r\n            const newRepCount = formAnalyzerRef.current.getRepCount();\r\n            setRepCount(newRepCount);\r\n\r\n            // Store rep data\r\n            repsDataRef.current.push({\r\n              repNumber: newRepCount,\r\n              valid: true,\r\n              feedback: analysis.feedback,\r\n              timestamp: Date.now(),\r\n            });\r\n          }\r\n\r\n          // Update phase\r\n          setPhase(analysis.phase);\r\n\r\n          // Draw skeleton\r\n          drawSkeleton(landmarks);\r\n        }\r\n\r\n        lastTimestamp = now;\r\n      } catch (err) {\r\n        console.error(\"Detection error:\", err);\r\n      }\r\n\r\n      animationFrameRef.current = requestAnimationFrame(detectLoop);\r\n    }\r\n\r\n    detectLoop();\r\n\r\n    return () => {\r\n      if (animationFrameRef.current) {\r\n        cancelAnimationFrame(animationFrameRef.current);\r\n      }\r\n    };\r\n  }, [isActive]);\r\n\r\n  const drawSkeleton = useCallback((landmarks: any[]) => {\r\n    const canvas = canvasRef.current;\r\n    const video = videoRef.current;\r\n    if (!canvas || !video) return;\r\n\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return;\r\n\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Draw landmarks\r\n    ctx.fillStyle = \"#00FF00\";\r\n    landmarks.forEach((landmark) => {\r\n      const x = landmark.x * canvas.width;\r\n      const y = landmark.y * canvas.height;\r\n      ctx.beginPath();\r\n      ctx.arc(x, y, 5, 0, 2 * Math.PI);\r\n      ctx.fill();\r\n    });\r\n\r\n    // Draw connections (simplified)\r\n    ctx.strokeStyle = \"#00FF00\";\r\n    ctx.lineWidth = 2;\r\n    const connections = [\r\n      [11, 12],\r\n      [11, 13],\r\n      [13, 15],\r\n      [12, 14],\r\n      [14, 16], // Arms\r\n      [11, 23],\r\n      [12, 24],\r\n      [23, 24], // Torso\r\n      [23, 25],\r\n      [25, 27],\r\n      [24, 26],\r\n      [26, 28], // Legs\r\n    ];\r\n\r\n    connections.forEach(([start, end]) => {\r\n      const startLandmark = landmarks[start];\r\n      const endLandmark = landmarks[end];\r\n      if (startLandmark && endLandmark) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(\r\n          startLandmark.x * canvas.width,\r\n          startLandmark.y * canvas.height,\r\n        );\r\n        ctx.lineTo(endLandmark.x * canvas.width, endLandmark.y * canvas.height);\r\n        ctx.stroke();\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  const handleStop = useCallback(() => {\r\n    setIsActive(false);\r\n    onComplete(repsDataRef.current, allFeedbackRef.current);\r\n  }, [onComplete]);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div\r\n        className=\"flex items-center justify-center h-screen bg-slate-900\"\r\n        data-oid=\"2hihyhk\"\r\n      >\r\n        <div className=\"text-center\" data-oid=\"oe.mfof\">\r\n          <div\r\n            className=\"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4\"\r\n            data-oid=\"z.nf82_\"\r\n          ></div>\r\n          <p className=\"text-white text-lg\" data-oid=\"v0p15jg\">\r\n            Initializing camera and AI...\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div\r\n        className=\"flex items-center justify-center h-screen bg-slate-900 p-4\"\r\n        data-oid=\"6jd8u80\"\r\n      >\r\n        <div className=\"text-center max-w-md\" data-oid=\"65y86by\">\r\n          <div\r\n            className=\"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4\"\r\n            data-oid=\"n:.p5_n\"\r\n          >\r\n            <svg\r\n              className=\"w-8 h-8 text-red-400\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n              data-oid=\"fr5k57q\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M6 18L18 6M6 6l12 12\"\r\n                data-oid=\"7fb01ap\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <h2\r\n            className=\"text-xl font-semibold text-white mb-2\"\r\n            data-oid=\"4-66v:-\"\r\n          >\r\n            Setup Error\r\n          </h2>\r\n          <p className=\"text-gray-400 mb-4\" data-oid=\"giniyhg\">\r\n            {error}\r\n          </p>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className=\"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600\"\r\n            data-oid=\"jik9a5s\"\r\n          >\r\n            Try Again\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className=\"relative h-screen bg-slate-900 overflow-hidden\"\r\n      data-oid=\"u21w:30\"\r\n    >\r\n      {/* Video Feed */}\r\n      <div className=\"relative w-full h-full\" data-oid=\"16zzk30\">\r\n        <video\r\n          ref={videoRef}\r\n          className=\"absolute inset-0 w-full h-full object-cover transform scale-x-[-1]\"\r\n          playsInline\r\n          muted\r\n          data-oid=\"sd-z8cc\"\r\n        />\r\n\r\n        <canvas\r\n          ref={canvasRef}\r\n          className=\"absolute inset-0 w-full h-full transform scale-x-[-1]\"\r\n          data-oid=\"d_1z418\"\r\n        />\r\n      </div>\r\n\r\n      {/* Overlay UI */}\r\n      <div className=\"absolute inset-0 pointer-events-none\" data-oid=\"asukeiz\">\r\n        {/* Top Bar */}\r\n        <div\r\n          className=\"absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/50 to-transparent\"\r\n          data-oid=\"agi5bm3\"\r\n        >\r\n          <div className=\"flex items-center justify-between\" data-oid=\"djx3bdv\">\r\n            <div\r\n              className=\"bg-black/50 backdrop-blur-sm px-4 py-2 rounded-full\"\r\n              data-oid=\"05:cv0_\"\r\n            >\r\n              <span\r\n                className=\"text-white text-sm font-medium\"\r\n                data-oid=\"qyhcmy6\"\r\n              >\r\n                Phase: {phase}\r\n              </span>\r\n            </div>\r\n            <div\r\n              className=\"bg-black/50 backdrop-blur-sm px-4 py-2 rounded-full\"\r\n              data-oid=\"tvyn3nu\"\r\n            >\r\n              <span\r\n                className=\"text-white text-sm font-medium\"\r\n                data-oid=\"vb58-dr\"\r\n              >\r\n                Reps: {repCount}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Center - Rep Counter */}\r\n        <div\r\n          className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2\"\r\n          data-oid=\"xet55vi\"\r\n        >\r\n          <div\r\n            className=\"text-8xl font-bold text-white drop-shadow-2xl\"\r\n            data-oid=\"282awy8\"\r\n          >\r\n            {repCount}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Feedback Messages */}\r\n        <div\r\n          className=\"absolute top-24 left-1/2 transform -translate-x-1/2 w-full max-w-md px-4\"\r\n          data-oid=\"ga1lm7a\"\r\n        >\r\n          {currentFeedback.map((feedback, index) => (\r\n            <div\r\n              key={`${feedback.timestamp}-${index}`}\r\n              className={`mb-2 p-4 rounded-lg backdrop-blur-md animate-fade-in ${\r\n                feedback.severity === \"error\"\r\n                  ? \"bg-red-500/80\"\r\n                  : feedback.severity === \"warning\"\r\n                    ? \"bg-yellow-500/80\"\r\n                    : \"bg-green-500/80\"\r\n              }`}\r\n              data-oid=\"ykjn:0h\"\r\n            >\r\n              <p\r\n                className=\"text-white font-semibold text-center\"\r\n                data-oid=\"efjyr2t\"\r\n              >\r\n                {feedback.message}\r\n              </p>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Bottom Controls */}\r\n        <div\r\n          className=\"absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black/50 to-transparent\"\r\n          data-oid=\"uf8vhh0\"\r\n        >\r\n          <div\r\n            className=\"flex items-center justify-center gap-4\"\r\n            data-oid=\"8kjst_a\"\r\n          >\r\n            <button\r\n              onClick={handleStop}\r\n              className=\"pointer-events-auto px-8 py-4 bg-red-500 text-white font-semibold rounded-full hover:bg-red-600 transition-colors shadow-lg\"\r\n              data-oid=\"j:y.uze\"\r\n            >\r\n              End Session\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 962, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/egors/AI-Fusion/frontend/src/lib/exercises.ts"],"sourcesContent":["import { Exercise, ExerciseType } from \"@/types/exercise\";\r\n\r\nexport const exercises: Record<ExerciseType, Exercise> = {\r\n  squat: {\r\n    id: \"squat\",\r\n    name: \"Squat\",\r\n    description:\r\n      \"Master the fundamental lower body movement pattern with proper depth and alignment.\",\r\n    cameraAngle: \"side\",\r\n    icon: \"ü¶µ\",\r\n    targetMuscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Core\"],\r\n    commonErrors: [\r\n      \"Knees caving inward\",\r\n      \"Excessive forward lean\",\r\n      \"Insufficient depth\",\r\n      \"Heels lifting off ground\",\r\n      \"Lower back rounding\",\r\n    ],\r\n  },\r\n  deadlift: {\r\n    id: \"deadlift\",\r\n    name: \"Deadlift / Hip Hinge\",\r\n    description:\r\n      \"Learn the hip hinge pattern essential for posterior chain development and injury prevention.\",\r\n    cameraAngle: \"side\",\r\n    icon: \"üí™\",\r\n    targetMuscles: [\"Hamstrings\", \"Glutes\", \"Lower Back\", \"Core\"],\r\n    commonErrors: [\r\n      \"Back rounding\",\r\n      \"Hips rising too fast\",\r\n      \"Bar drifting away from body\",\r\n      \"Knees locking too early\",\r\n      \"Improper breathing\",\r\n    ],\r\n  },\r\n  pushup: {\r\n    id: \"pushup\",\r\n    name: \"Push-Up\",\r\n    description:\r\n      \"Perfect your upper body pressing mechanics and core stability.\",\r\n    cameraAngle: \"side\",\r\n    icon: \"üí•\",\r\n    targetMuscles: [\"Chest\", \"Triceps\", \"Shoulders\", \"Core\"],\r\n    commonErrors: [\r\n      \"Sagging hips\",\r\n      \"Flaring elbows\",\r\n      \"Incomplete range of motion\",\r\n      \"Head dropping\",\r\n      \"Pike position\",\r\n    ],\r\n  },\r\n  row: {\r\n    id: \"row\",\r\n    name: \"Row\",\r\n    description:\r\n      \"Develop proper pulling mechanics and posterior shoulder strength.\",\r\n    cameraAngle: \"front\",\r\n    icon: \"üö£\",\r\n    targetMuscles: [\"Upper Back\", \"Lats\", \"Rhomboids\", \"Biceps\"],\r\n    commonErrors: [\r\n      \"Excessive momentum\",\r\n      \"Shoulder shrugging\",\r\n      \"Elbow flaring\",\r\n      \"Incomplete scapular retraction\",\r\n      \"Torso rotation\",\r\n    ],\r\n  },\r\n  \"overhead-press\": {\r\n    id: \"overhead-press\",\r\n    name: \"Overhead Press\",\r\n    description:\r\n      \"Build stable overhead pressing mechanics and shoulder health.\",\r\n    cameraAngle: \"front\",\r\n    icon: \"üèãÔ∏è\",\r\n    targetMuscles: [\"Shoulders\", \"Triceps\", \"Upper Chest\", \"Core\"],\r\n    commonErrors: [\r\n      \"Excessive lower back arch\",\r\n      \"Bar path not straight\",\r\n      \"Head not passing through\",\r\n      \"Core instability\",\r\n      \"Incomplete lockout\",\r\n    ],\r\n  },\r\n};\r\n\r\nexport const getExercise = (id: ExerciseType): Exercise => exercises[id];\r\n\r\nexport const getAllExercises = (): Exercise[] => Object.values(exercises);\r\n"],"names":[],"mappings":";;;;;;;;AAEO,MAAM,YAA4C;IACvD,OAAO;QACL,IAAI;QACJ,MAAM;QACN,aACE;QACF,aAAa;QACb,MAAM;QACN,eAAe;YAAC;YAAc;YAAU;YAAc;SAAO;QAC7D,cAAc;YACZ;YACA;YACA;YACA;YACA;SACD;IACH;IACA,UAAU;QACR,IAAI;QACJ,MAAM;QACN,aACE;QACF,aAAa;QACb,MAAM;QACN,eAAe;YAAC;YAAc;YAAU;YAAc;SAAO;QAC7D,cAAc;YACZ;YACA;YACA;YACA;YACA;SACD;IACH;IACA,QAAQ;QACN,IAAI;QACJ,MAAM;QACN,aACE;QACF,aAAa;QACb,MAAM;QACN,eAAe;YAAC;YAAS;YAAW;YAAa;SAAO;QACxD,cAAc;YACZ;YACA;YACA;YACA;YACA;SACD;IACH;IACA,KAAK;QACH,IAAI;QACJ,MAAM;QACN,aACE;QACF,aAAa;QACb,MAAM;QACN,eAAe;YAAC;YAAc;YAAQ;YAAa;SAAS;QAC5D,cAAc;YACZ;YACA;YACA;YACA;YACA;SACD;IACH;IACA,kBAAkB;QAChB,IAAI;QACJ,MAAM;QACN,aACE;QACF,aAAa;QACb,MAAM;QACN,eAAe;YAAC;YAAa;YAAW;YAAe;SAAO;QAC9D,cAAc;YACZ;YACA;YACA;YACA;YACA;SACD;IACH;AACF;AAEO,MAAM,cAAc,CAAC,KAA+B,SAAS,CAAC,GAAG;AAEjE,MAAM,kBAAkB,IAAkB,OAAO,MAAM,CAAC","debugId":null}},
    {"offset": {"line": 1078, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/egors/AI-Fusion/frontend/src/app/workout/%5BexerciseId%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport React from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport WorkoutCamera from \"@/components/WorkoutCamera\";\r\nimport { getExercise } from \"@/lib/exercises\";\r\nimport { ExerciseType, FormFeedback, RepData } from \"@/types/exercise\";\r\n\r\nexport default function WorkoutPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const exerciseId = params.exerciseId as ExerciseType;\r\n  const exercise = getExercise(exerciseId);\r\n\r\n  const [showInstructions, setShowInstructions] = useState(true);\r\n  const [mode, setMode] = useState<'camera' | 'upload'>(\"camera\");\r\n  const [uploading, setUploading] = useState(false);\r\n  const [feedback, setFeedback] = useState<FormFeedback[] | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const handleComplete = (reps: RepData[], feedback: FormFeedback[]) => {\r\n    // Store session data in sessionStorage\r\n    const sessionData = {\r\n      exerciseId,\r\n      reps,\r\n      feedback,\r\n      endTime: Date.now(),\r\n    };\r\n    sessionStorage.setItem(\"workoutSession\", JSON.stringify(sessionData));\r\n    router.push(\"/summary\");\r\n  };\r\n\r\n  if (showInstructions) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4\">\r\n        <div className=\"max-w-2xl w-full bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-2xl p-8\">\r\n          {/* Exercise Info */}\r\n          <div className=\"text-center mb-8\" data-oid=\"rwd0uex\">\r\n            <div className=\"text-6xl mb-4\" data-oid=\"9qd7y5y\">\r\n              {exercise.icon}\r\n            </div>\r\n            <h1\r\n              className=\"text-3xl font-bold text-white mb-2\"\r\n              data-oid=\"o6cfqzt\"\r\n            >\r\n              {exercise.name}\r\n            </h1>\r\n            <p className=\"text-gray-400\" data-oid=\"80m1lwd\">\r\n              {exercise.description}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Setup Instructions */}\r\n          <div className=\"space-y-6 mb-8\" data-oid=\"tgj8dg4\">\r\n            <div data-oid=\"krc5vi9\">\r\n              <h2\r\n                className=\"text-xl font-semibold text-white mb-4 flex items-center gap-2\"\r\n                data-oid=\"jzkh02q\"\r\n              >\r\n                <svg\r\n                  className=\"w-6 h-6 text-blue-400\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  data-oid=\"j48-fet\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"\r\n                    data-oid=\"1d4ci-x\"\r\n                  />\r\n\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"\r\n                    data-oid=\"k4yifzo\"\r\n                  />\r\n                </svg>\r\n                Camera Setup\r\n              </h2>\r\n              <div\r\n                className=\"bg-slate-900/50 rounded-lg p-4 space-y-2\"\r\n                data-oid=\"qk8y4.8\"\r\n              >\r\n                <p\r\n                  className=\"text-gray-300 flex items-start gap-2\"\r\n                  data-oid=\"frj-4lg\"\r\n                >\r\n                  <span\r\n                    className=\"text-blue-400 font-semibold\"\r\n                    data-oid=\"fg.eej4\"\r\n                  >\r\n                    ‚Ä¢\r\n                  </span>\r\n                  <span data-oid=\"gfryse2\">\r\n                    Position phone{\" \"}\r\n                    <strong className=\"text-white\" data-oid=\"3bzq-6n\">\r\n                      6-8 feet away\r\n                    </strong>{\" \"}\r\n                    at hip height\r\n                  </span>\r\n                </p>\r\n                <p\r\n                  className=\"text-gray-300 flex items-start gap-2\"\r\n                  data-oid=\"g-533hd\"\r\n                >\r\n                  <span\r\n                    className=\"text-blue-400 font-semibold\"\r\n                    data-oid=\"462ichl\"\r\n                  >\r\n                    ‚Ä¢\r\n                  </span>\r\n                  <span data-oid=\"2n2w2wc\">\r\n                    Use{\" \"}\r\n                    <strong className=\"text-white\" data-oid=\"2eojdxf\">\r\n                      {exercise.cameraAngle} view\r\n                    </strong>{\" \"}\r\n                    - your entire body should be visible\r\n                  </span>\r\n                </p>\r\n                <p\r\n                  className=\"text-gray-300 flex items-start gap-2\"\r\n                  data-oid=\"m:rb207\"\r\n                >\r\n                  <span\r\n                    className=\"text-blue-400 font-semibold\"\r\n                    data-oid=\"s-gz0xx\"\r\n                  >\r\n                    ‚Ä¢\r\n                  </span>\r\n                  <span data-oid=\"g:-ddwe\">\r\n                    Ensure good lighting and a clear background\r\n                  </span>\r\n                </p>\r\n                <p\r\n                  className=\"text-gray-300 flex items-start gap-2\"\r\n                  data-oid=\":20r.yd\"\r\n                >\r\n                  <span\r\n                    className=\"text-blue-400 font-semibold\"\r\n                    data-oid=\"bpnhmnu\"\r\n                  >\r\n                    ‚Ä¢\r\n                  </span>\r\n                  <span data-oid=\"sw2mc_l\">\r\n                    Grant camera permissions when prompted\r\n                  </span>\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Common Errors */}\r\n            <div data-oid=\"65nq_1j\">\r\n              <h2\r\n                className=\"text-xl font-semibold text-white mb-4 flex items-center gap-2\"\r\n                data-oid=\":-gaxew\"\r\n              >\r\n                <svg\r\n                  className=\"w-6 h-6 text-yellow-400\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                  data-oid=\"i5wpzaw\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\r\n                    data-oid=\"xue75f6\"\r\n                  />\r\n                </svg>\r\n                We'll Check For\r\n              </h2>\r\n              <div\r\n                className=\"bg-slate-900/50 rounded-lg p-4\"\r\n                data-oid=\"gkh3w8y\"\r\n              >\r\n                <ul className=\"space-y-2\" data-oid=\"rgmau6e\">\r\n                  {exercise.commonErrors.map((error, index) => (\r\n                    <li\r\n                      key={index}\r\n                      className=\"text-gray-300 flex items-start gap-2\"\r\n                      data-oid=\"r0g0xui\"\r\n                    >\r\n                      <span\r\n                        className=\"text-yellow-400 font-semibold\"\r\n                        data-oid=\"o3ya57m\"\r\n                      >\r\n                        ‚Ä¢\r\n                      </span>\r\n                      <span data-oid=\"f_zkh_b\">{error}</span>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Mode Selection */}\r\n          <div className=\"flex gap-4 mb-6\">\r\n            <button\r\n              className={`flex-1 px-6 py-4 rounded-lg font-semibold transition-colors ${mode === 'camera' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-gray-300'}`}\r\n              onClick={() => setMode('camera')}\r\n            >\r\n              Use Camera\r\n            </button>\r\n            <button\r\n              className={`flex-1 px-6 py-4 rounded-lg font-semibold transition-colors ${mode === 'upload' ? 'bg-blue-500 text-white' : 'bg-slate-700 text-gray-300'}`}\r\n              onClick={() => setMode('upload')}\r\n            >\r\n              Upload Video\r\n            </button>\r\n          </div>\r\n          {/* Start Button */}\r\n          <div className=\"flex gap-4\">\r\n            <button\r\n              onClick={() => router.back()}\r\n              className=\"flex-1 px-6 py-4 bg-slate-700 text-white font-semibold rounded-lg hover:bg-slate-600 transition-colors\"\r\n            >\r\n              Back\r\n            </button>\r\n            <button\r\n              onClick={() => setShowInstructions(false)}\r\n              className=\"flex-1 px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg\"\r\n            >\r\n              Start\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Main workout logic\r\n  if (mode === \"camera\") {\r\n    return (\r\n      <WorkoutCamera\r\n        exerciseId={exerciseId}\r\n        onComplete={handleComplete}\r\n      />\r\n    );\r\n  }\r\n\r\n  // Video upload mode\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4\">\r\n      <div className=\"max-w-xl w-full bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-2xl p-8\">\r\n        <h2 className=\"text-2xl font-bold text-white mb-4 text-center\">Upload Your Exercise Video</h2>\r\n        <form\r\n          onSubmit={async (e) => {\r\n            e.preventDefault();\r\n            setError(null);\r\n            setFeedback(null);\r\n            setUploading(true);\r\n            const formData = new FormData(e.target as HTMLFormElement);\r\n            try {\r\n              const res = await fetch(\"/api/analyze-video\", {\r\n                method: \"POST\",\r\n                body: formData,\r\n              });\r\n              if (!res.ok) throw new Error(\"Failed to analyze video\");\r\n              const data = await res.json();\r\n              setFeedback(data.feedback || []);\r\n            } catch (err: any) {\r\n              setError(err.message || \"Unknown error\");\r\n            } finally {\r\n              setUploading(false);\r\n            }\r\n          }}\r\n        >\r\n          <input\r\n            type=\"file\"\r\n            name=\"video\"\r\n            accept=\"video/*\"\r\n            required\r\n            className=\"block w-full mb-4 text-gray-200\"\r\n          />\r\n          <input type=\"hidden\" name=\"exerciseId\" value={exerciseId} />\r\n          <button\r\n            type=\"submit\"\r\n            disabled={uploading}\r\n            className=\"w-full px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors\"\r\n          >\r\n            {uploading ? \"Uploading...\" : \"Analyze Video\"}\r\n          </button>\r\n        </form>\r\n        {error && <div className=\"mt-4 text-red-400 text-center\">{error}</div>}\r\n        {feedback && (\r\n          <div className=\"mt-6\">\r\n            <h3 className=\"text-lg font-semibold text-white mb-2\">Feedback</h3>\r\n            <ul className=\"text-gray-300 space-y-2\">\r\n              {feedback.map((fb, idx) => (\r\n                <li key={idx}>{fb.message}</li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}